<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Quick Sort Full Visualization</title>
    <style>
        body { font-family: 'Tahoma', sans-serif; background-color: #f0f2f5; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .array-display { display: flex; justify-content: center; gap: 8px; margin: 40px 0; min-height: 100px; align-items: flex-start; }
        .cell {
            width: 55px; height: 55px; border: 2px solid #ccc; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; font-weight: bold; background: #fff; position: relative; transition: all 0.3s;
        }
        .cell.active-range { border-color: #8bc34a; background-color: #f1f8e9; }
        .cell.pivot { color: #d32f2f; border-color: #d32f2f; background-color: #ffebee; box-shadow: 0 0 10px rgba(211,47,47,0.3); }
        .cell.sorted { background-color: #e0e0e0; color: #9e9e9e; border-color: #e0e0e0; }
        
        .pointer { position: absolute; font-size: 13px; font-weight: bold; width: 100%; text-align: center; left: 0; }
        .ptr-r { bottom: -30px; color: #2e7d32; }
        .ptr-f { bottom: -50px; color: #1565c0; }
        
        .controls { display: flex; justify-content: center; gap: 10px; margin-top: 50px; }
        button { padding: 12px 25px; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        #nextBtn { background: #8bc34a; color: white; }
        #nextBtn:hover { background: #7cb342; }
        #nextBtn:disabled { background: #ccc; cursor: not-allowed; }
        .reset-btn { background: #757575; color: white; }
        
        .status-box { background: #fff3e0; padding: 15px; border-left: 5px solid #ffb300; margin-bottom: 20px; min-height: 50px; font-size: 18px; }
        .stack-info { font-size: 14px; color: #666; margin-top: 10px; }
        .ptr-label { font-size: 11px; opacity: 0.9; }
    </style>
</head>
<body>

<div class="container">
    <h2>‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á Quick Sort ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h2>
    <div class="status-box" id="status">‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç [44, 78, 22, 7, 98, 56, 34, 2, 38, 35, 45]</div>
    
    <div class="array-display" id="array-container"></div>

    <div class="controls">
        <button id="nextBtn" onclick="processStep()">Next Step (‡∏ó‡∏≥‡∏ï‡πà‡∏≠)</button>
        <button class="reset-btn" onclick="init()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
    </div>
    <div class="stack-info" id="stack-display"></div>
</div>

<script>
    // ‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: 44 78 22 7 98 56 34 2 38 35 45
    let items = [44, 78, 22, 7, 98, 56, 34, 2, 38, 35, 45];
    let sortedIndices = new Set();
    // ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏£‡∏≠‡∏ö‡∏™‡∏≠‡∏á: ‡∏ó‡∏≥‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡πà‡∏ß‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô (2 ‡∏ù‡∏±‡πà‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô)
    let activePartitions = []; // [{ low, high, r, f, pivotIdx }, ...]

    function init() {
        items = [44, 78, 22, 7, 98, 56, 34, 2, 38, 35, 45];
        sortedIndices.clear();
        // ‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å: ‡∏°‡∏µ‡πÅ‡∏Ñ‡πà‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏≠‡∏≤‡∏£‡πå‡πÄ‡∏£‡∏¢‡πå (‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏£‡∏Å)
        activePartitions = [{
            low: 0,
            high: items.length - 1,
            r: 0,
            f: items.length - 1,
            pivotIdx: items.length - 1
        }];
        document.getElementById('nextBtn').disabled = false;
        updateStatusRound();
        render();
    }

    function makePartition(low, high) {
        return { low, high, r: low, f: high, pivotIdx: high };
    }

    // ‡∏ó‡∏≥‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏™‡πÄ‡∏ï‡∏õ‡πÉ‡∏ô partition ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
    // ‡∏Å‡∏£‡∏ì‡∏µ pivot ‡∏≠‡∏¢‡∏π‡πà F: R>F ‚Üí ‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏Ç‡∏¢‡∏±‡∏ö F | R<F ‚Üí ‡∏Ç‡∏¢‡∏±‡∏ö R
    // ‡∏Å‡∏£‡∏ì‡∏µ pivot ‡∏≠‡∏¢‡∏π‡πà R: R>F ‚Üí ‡∏Ç‡∏¢‡∏±‡∏ö F | R<F ‚Üí ‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏Ç‡∏¢‡∏±‡∏ö R
    function doOneStep(p) {
        let { low, high, r, f, pivotIdx } = p;
        if (r >= f) {
            // R ‡∏Å‡∏±‡∏ö F ‡πÄ‡∏à‡∏≠‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏≤‡∏á pivot ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á r ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏ö‡πà‡∏á‡∏ä‡πà‡∏ß‡∏á (‡∏Ñ‡πà‡∏≤‡∏û‡∏¥‡∏ß‡∏≠‡∏ï‡∏≠‡∏≤‡∏à‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà pivotIdx)
            if (pivotIdx !== r) {
                [items[pivotIdx], items[r]] = [items[r], items[pivotIdx]];
            }
            return r;
        }

        if (pivotIdx === f) {
            // Pivot ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà F
            if (items[r] > items[f]) {
                [items[r], items[f]] = [items[f], items[r]];
                p.pivotIdx = r;
                p.f = f - 1;
            } else {
                p.r = r + 1;
            }
        } else {
            // Pivot ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà R
            if (items[r] > items[f]) {
                p.f = f - 1; // ‡∏Ç‡∏¢‡∏±‡∏ö F
            } else {
                [items[r], items[f]] = [items[f], items[r]];
                p.pivotIdx = f;
                p.r = r + 1; // ‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏Ç‡∏¢‡∏±‡∏ö R
            }
        }
        return (p.r >= p.f) ? p.r : null;
    }

    function updateStatusRound() {
        if (activePartitions.length === 0) {
            document.getElementById('status').innerText = "üéâ ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß!";
            return;
        }
        const parts = activePartitions.map((p, i) =>
            `‡∏ä‡πà‡∏ß‡∏á${activePartitions.length > 1 ? i + 1 : ''} [${p.low}-${p.high}] Pivot=${items[p.pivotIdx]}`
        ).join(' | ');
        document.getElementById('status').innerText = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô ${activePartitions.length} ‡∏ù‡∏±‡πà‡∏á: ${parts}`;
    }

    function processStep() {
        if (activePartitions.length === 0) return;

        const nextPartitions = [];
        const statusLines = [];

        for (const p of activePartitions) {
            const doneR = doOneStep(p);
            if (doneR !== null) {
                sortedIndices.add(doneR);
                statusLines.push(`‡∏ß‡∏≤‡∏á ${items[doneR]} ‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`);
                if (p.low <= doneR - 1) nextPartitions.push(makePartition(p.low, doneR - 1));
                if (doneR + 1 <= p.high) nextPartitions.push(makePartition(doneR + 1, p.high));
            } else {
                nextPartitions.push(p);
                if (p.pivotIdx === p.f) {
                    if (items[p.r] > items[p.f]) statusLines.push(`‡∏™‡∏•‡∏±‡∏ö R(${items[p.r]}) ‡∏Å‡∏±‡∏ö Pivot ‚Üí ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô F`);
                    else statusLines.push(`R(${items[p.r]}) ‚â§ Pivot ‚Üí ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô R`);
                } else {
                    if (items[p.f] < items[p.r]) statusLines.push(`‡∏™‡∏•‡∏±‡∏ö F(${items[p.f]}) ‡∏Å‡∏±‡∏ö Pivot ‚Üí ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô R`);
                    else statusLines.push(`F(${items[p.f]}) ‚â• Pivot ‚Üí ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô F`);
                }
            }
        }

        activePartitions = nextPartitions;
        if (statusLines.length) document.getElementById('status').innerText = statusLines.join(' | ');
        updateStatusRound();
        if (activePartitions.length === 0) document.getElementById('nextBtn').disabled = true;
        render();
    }

    function render() {
        const container = document.getElementById('array-container');
        container.innerHTML = '';

        items.forEach((val, i) => {
            const cell = document.createElement('div');
            cell.className = 'cell';

            let inRange = false;
            let isPivot = false;
            let showR = false;
            let showF = false;
            let partLabel = '';

            for (let k = 0; k < activePartitions.length; k++) {
                const p = activePartitions[k];
                if (i >= p.low && i <= p.high) {
                    inRange = true;
                    if (activePartitions.length > 1) partLabel = String(k + 1);
                    if (i === p.pivotIdx) isPivot = true;
                    if (i === p.r) showR = true;
                    if (i === p.f) showF = true;
                    break;
                }
            }

            if (inRange) cell.classList.add('active-range');
            if (isPivot) cell.classList.add('pivot');
            if (sortedIndices.has(i)) cell.classList.add('sorted');
            cell.innerText = val;

            if (showR) {
                const pr = document.createElement('div');
                pr.className = 'pointer ptr-r';
                pr.innerText = partLabel ? `‚Üë R${partLabel}` : '‚Üë R';
                cell.appendChild(pr);
            }
            if (showF) {
                const pf = document.createElement('div');
                pf.className = 'pointer ptr-f';
                pf.innerText = partLabel ? `‚Üë F${partLabel}` : '‚Üë F';
                cell.appendChild(pf);
            }
            container.appendChild(cell);
        });

        document.getElementById('stack-display').innerText =
            `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô: ${activePartitions.length} ${activePartitions.length ? `‚Üí ${activePartitions.map(p => `[${p.low}-${p.high}]`).join(', ')}` : ''}`;
    }

    init();
</script>

</body>
</html>